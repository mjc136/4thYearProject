{% extends "base.html" %}

{% block title %}Scenarios | LingoLizard{% endblock %}

{% block content %}
<div class="container mt-5 text-white">
    <h2 class="mb-4">Choose Your Scenario</h2>

    <!-- XP Progress -->
    <div class="mb-4">
        <div class="progress" style="height: 25px; background-color: rgba(255,255,255,0.2);">
            <div class="progress-bar bg-success" role="progressbar"
                style="width: {{ [user.xp, 100]|min }}%;"
                aria-valuenow="{{ user.xp }}" aria-valuemin="0" aria-valuemax="100"
                aria-label="XP progress bar">
                Level {{ user.level }} - {{ user.xp }}%
            </div>
        </div>
        <p class="mt-2 text-light"><small>Complete scenarios to earn XP and unlock more challenging conversations!</small></p>
    </div>

    <!-- Scenario Cards -->
    <div class="row row-cols-1 row-cols-md-3 g-4">

        {% set all_scenarios = dict(
            taxi       = dict(title="Taxi Ride",        desc="Navigate a conversation with a taxi driver to reach your destination.", tier="Beginner", badge="success"),
            restaurant = dict(title="Restaurant Order", desc="Order food and drinks at a local restaurant.",                          tier="Beginner", badge="success"),
            shopping   = dict(title="Shopping",         desc="Shop for clothes and accessories at a local store.",                   tier="Beginner", badge="success"),
            hotel      = dict(title="Hotel Booking",    desc="Make a reservation and discuss accommodations with hotel staff.",      tier="Intermediate", badge="warning"),
            doctor     = dict(title="Doctor’s Visit",   desc="Explain symptoms and understand medical advice during a check-up.",     tier="Intermediate", badge="warning"),
            interview  = dict(title="Job Interview",    desc="Showcase your skills and experience in a professional interview setting.", tier="Advanced", badge="danger")
        ) %}

        {% for scenario, info in all_scenarios.items() %}
        <div class="col">
            <div class="card h-100 bg-dark text-white border-{{ info.badge }}">
                <div class="card-body">
                    <h5 class="card-title">{{ info.title }}</h5>
                    <p class="card-text">{{ info.desc }}</p>
                    <p class="text-light">
                        <span class="badge bg-{{ info.badge }}{% if info.badge == 'warning' %} text-dark{% endif %}">
                            {{ info.tier }}
                        </span>
                    </p>

                    {% if scenario in user.unlocked_scenarios %}
                        <button class="btn btn-{{ info.badge }}{% if info.badge == 'warning' %} text-dark{% endif %} w-100"
                                onclick="location.href='/chat?scenario={{ scenario }}'">Start Scenario</button>
                        {% if scenario in user.completed_scenarios %}
                            <div class="mt-2 text-center">
                                <span class="badge bg-light text-dark">✓ Completed</span>
                            </div>
                        {% endif %}
                    {% else %}
                        <button class="btn btn-secondary w-100" disabled
                                data-bs-toggle="tooltip" data-bs-placement="top"
                                title="Locked: Complete previous tier to unlock">
                            {{ info.tier }} Locked
                        </button>
                    {% endif %}
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
</div>

<!-- Bootstrap Tooltips -->
<script>
    document.addEventListener('DOMContentLoaded', function() {
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[data-bs-toggle="tooltip"]'))
        tooltipTriggerList.map(el => new bootstrap.Tooltip(el))
    });
</script>
{% endblock %}
